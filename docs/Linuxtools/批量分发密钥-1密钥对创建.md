设置 SSH 通过密钥登录

使用ssh-keygen命令创建密钥对  
ssh-keygen -t rsa \#
除了rsa格式，还有dsa格式，只不过rsa可以实现加密认证也可以进行签名认证，dsa只能用于签名认证  
  
执行命令后根据提示输入密钥密码和存放路径（可以直接回车留空），  
用户的家目录中生成了

公钥(/root/.ssh/id_rsa.pub)

私钥(/root/.ssh/id_rsa)

非交互式生成秘钥对  
ssh-keygen -t rsa -P '' -f \~/.ssh/id_rsa \>/dev/null 2\>&1  
ssh-keygen:生成密钥对命令  
-t：指定密钥对的密码加密类型（rsa，dsa两种）  
-f：指定密钥对文件的生成路径包含文件名  
-P（大写）：指定密钥对的密码

echo -e "\\n"\|ssh-keygen -t rsa -N "" &\> /dev/null  
\#把公钥发送到机器上  
ssh-copy-id -i /root/.ssh/id_rsa.pub root\@192.168.21.61  
\#公钥发送过去之后，登录对方的机器不用密码了。  
  
私钥自己保存（丢了服务器可就没法再登陆了）公钥则可以任意公开。

给指定地址发一个实现免密钥登陆 实现对地址免密登陆  
ssh-copy-id root\@192.168.21.71 \# 发送密钥  
ssh -i \~/.ssh/id_rsa root\@192.168.21.71 -p 22 \# 测试 -i 指定密钥 -p 指定端口  
  
或者将公钥导入到authorized_keys  
cat /root/.ssh/id_rsa.pub \>\> /root/.ssh/authorized_keys  
注意权限 私钥权限是600，公钥为644，而.ssh目录权限是700  
chmod 600 authorized_keys  
chmod 700 \~/.ssh  
  
出于安全的考虑，可能有定期更换密钥的需求。其实批量推送与批量更改实现原理是一致的：  
1.生成新的密钥时，使用 -f 选项，避免新生成的密钥覆盖老的密钥  
ssh-keygen -t rsa -f \~/.ssh/id_rsa_new  
  
3、设置 SSH，打开密钥登录功能  
编辑 /etc/ssh/sshd_config 文件，启用密钥认证  
RSAAuthentication yes  
PubkeyAuthentication yes  
另外，请留意 root 用户能否通过 SSH 登录：  
PermitRootLogin yes  
当你完成全部设置，并以密钥方式登录成功后，再禁用密码登录：  
PasswordAuthentication no  
最后，重启 SSH 服务：
